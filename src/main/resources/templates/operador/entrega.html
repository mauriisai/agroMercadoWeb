<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8">
  <title>Seleccionar Entrega</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>
<body>
<div th:replace="fragments/header :: navbar"></div>

<div class="container mt-5" style="max-width: 700px;">
  <h3 class="text-success mb-4">Seleccionar M茅todo de Entrega </h3>

  <div class="alert alert-info">
    <strong>Resumen del pedido:</strong>
    <span th:text="${reservas.size() + ' productos - Total: $' + #numbers.formatDecimal(totalGeneral, 1, 'POINT', 2, 'COMMA')}"></span>
  </div>

  <form th:action="@{/operador/procesar-entrega}" method="post" th:object="${entregaDTO}">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

    <!-- Modalidad de Entrega -->
    <div class="mb-4">
      <label class="form-label fw-bold">驴C贸mo quieres recibir tu pedido?</label>
      <div class="form-check">
        <input class="form-check-input" type="radio" th:field="*{modalidadEntrega}"
               id="domicilio" value="DOMICILIO" checked>
        <label class="form-check-label" for="domicilio">
          <i class="bi bi-truck"></i> Entrega a Domicilio
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" th:field="*{modalidadEntrega}"
               id="retiro" value="RETIRO_EN_SITIO">
        <label class="form-check-label" for="retiro">
          <i class="bi bi-shop"></i> Retiro en Sitio
        </label>
      </div>
    </div>

    <!-- Direcci贸n (solo para domicilio) -->
    <div id="direccionGroup" class="mb-3">
      <label for="direccionEntrega" class="form-label fw-bold">Direcci贸n de Entrega</label>
      <textarea id="direccionEntrega" th:field="*{direccionEntrega}"
                class="form-control" rows="3"
                placeholder="Ingresa tu direcci贸n completa..."></textarea>
      <div class="form-text">Para entregas a domicilio, ingresa tu direcci贸n exacta.</div>
    </div>

    <!-- Fecha de Entrega -->
    <div class="mb-3">
      <label for="fechaEntrega" class="form-label fw-bold">Fecha deseada de entrega/retiro</label>
      <input type="datetime-local" id="fechaEntrega" th:field="*{fechaEntrega}"
             class="form-control" min="" required>
    </div>

    <div class="text-center mt-4">
      <a th:href="@{/comprador/carrito}" class="btn btn-secondary btn-lg ms-2">
        <i class="bi bi-arrow-left"></i> Volver al Carrito
      </a>
      <form th:action="@{/reserva/form-procesarPago}" method="get">
        <button type="submit"
                class="btn btn-success btn-lg"
                th:disabled="${reservas == null or reservas.empty}">
          <i class="bi bi-credit-card"></i> Continuar al pago
        </button>
      </form>
    </div>
  </form>
</div>

<div th:replace="fragments/footer :: footer"></div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const domicilioRadio = document.getElementById('domicilio');
        const retiroRadio = document.getElementById('retiro');
        const direccionGroup = document.getElementById('direccionGroup');

        function toggleDireccion() {
            direccionGroup.style.display = domicilioRadio.checked ? 'block' : 'none';
            if (domicilioRadio.checked) {
                document.getElementById('direccionEntrega').required = true;
            } else {
                document.getElementById('direccionEntrega').required = false;
            }
        }

        domicilioRadio.addEventListener('change', toggleDireccion);
        retiroRadio.addEventListener('change', toggleDireccion);
        toggleDireccion(); // Ejecutar al cargar

        // Establecer fecha m铆nima (hoy + 1 d铆a)
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('fechaEntrega').min = tomorrow.toISOString().slice(0, 16);
    });
</script>
</body>
</html>